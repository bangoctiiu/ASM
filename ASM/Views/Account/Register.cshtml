@model ASM.Models.RegisterViewModel

@{
    ViewData["Title"] = "Đăng ký tài khoản";
}

<div class="auth-container">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-7 col-xl-6">
            <div class="card shadow-lg border-0 rounded-lg mt-5 auth-card">
                <div class="card-header text-center bg-primary text-white">
                    <h3 class="fw-bold my-2">Tạo tài khoản mới 🚀</h3>
                </div>
                <div class="card-body p-4">
                    <div class="text-center mb-4">
                        <p class="text-muted">Chỉ một vài bước để bắt đầu hành trình của bạn.</p>
                    </div>

                    <form asp-controller="Account" asp-action="Register" method="post">
                        <div asp-validation-summary="ModelOnly" class="text-danger mb-3" role="alert"></div>

                        @if (TempData["Success"] != null)
                        {
                            <div class="alert alert-success">@TempData["Success"]</div>
                        }

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <input asp-for="FullName" class="form-control" placeholder="Họ và tên" />
                                    <label asp-for="FullName"><i class="fa-solid fa-user me-2"></i>Họ và tên</label>
                                    <span asp-validation-for="FullName" class="text-danger small mt-1 d-block"></span>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <input asp-for="Username" class="form-control" placeholder="Tên đăng nhập" />
                                    <label asp-for="Username"><i class="fa-solid fa-at me-2"></i>Tên đăng nhập</label>
                                    <span asp-validation-for="Username" class="text-danger small mt-1 d-block"></span>
                                </div>
                            </div>
                        </div>

                        <div class="form-floating mb-3">
                            <input asp-for="Email" class="form-control" placeholder="Email" />
                            <label asp-for="Email"><i class="fa-solid fa-envelope me-2"></i>Địa chỉ Email</label>
                            <span asp-validation-for="Email" class="text-danger small mt-1 d-block"></span>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="input-group">
                                    <div class="form-floating">
                                        <input asp-for="Password" type="password" id="passwordInput" class="form-control" placeholder="Mật khẩu" />
                                        <label asp-for="Password"><i class="fa-solid fa-lock me-2"></i>Mật khẩu</label>
                                    </div>
                                    <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                        <i class="fa-solid fa-eye"></i>
                                    </button>
                                </div>
                                <span asp-validation-for="Password" class="text-danger small mt-1 d-block"></span>
                                <div class="mt-2">
                                    <div class="progress" style="height: 5px;">
                                        <div id="passwordStrengthBar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <small id="passwordStrengthText" class="form-text"></small>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="input-group">
                                    <div class="form-floating">
                                        <input asp-for="ConfirmPassword" type="password" id="confirmPasswordInput" class="form-control" placeholder="Xác nhận mật khẩu" />
                                        <label asp-for="ConfirmPassword"><i class="fa-solid fa-check-double me-2"></i>Xác nhận mật khẩu</label>
                                    </div>
                                    <button class="btn btn-outline-secondary" type="button" id="toggleConfirmPassword">
                                        <i class="fa-solid fa-eye"></i>
                                    </button>
                                </div>
                                <span asp-validation-for="ConfirmPassword" class="text-danger small mt-1 d-block"></span>
                            </div>
                        </div>

                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-primary btn-lg fw-bold">Đăng ký</button>
                        </div>
                    </form>
                </div>
                <div class="card-footer text-center py-3">
                    <small class="text-muted">
                        Đã có tài khoản?
                        <a asp-controller="Account" asp-action="Login" class="text-decoration-none fw-bold">Đăng nhập ngay</a>
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        $(document).ready(function () {
            // Hàm bật/tắt hiển thị mật khẩu
            function togglePasswordVisibility(inputId, toggleButton) {
                const passwordInput = $(inputId);
                const icon = $(toggleButton).find('i');
                const type = passwordInput.attr('type') === 'password' ? 'text' : 'password';
                passwordInput.attr('type', type);
                icon.toggleClass('fa-eye fa-eye-slash');
            }

            // Gán sự kiện cho 2 nút
            $('#togglePassword').on('click', function() {
                togglePasswordVisibility('#passwordInput', this);
            });

            $('#toggleConfirmPassword').on('click', function() {
                togglePasswordVisibility('#confirmPasswordInput', this);
            });

            // Hàm kiểm tra độ mạnh mật khẩu
            $('#passwordInput').on('keyup', function () {
                let password = $(this).val();
                let strength = 0;
                let strengthText = '';
                let strengthBarClass = 'progress-bar';

                if (password.length >= 8) strength++;
                if (password.match(/[a-z]/)) strength++;
                if (password.match(/[A-Z]/)) strength++;
                if (password.match(/[0-9]/)) strength++;
                if (password.match(/[^a-zA-Z0-9]/)) strength++;

                let width = (strength / 5) * 100;

                switch (strength) {
                    case 0:
                    case 1:
                        strengthText = 'Rất yếu';
                        strengthBarClass += ' bg-danger';
                        break;
                    case 2:
                        strengthText = 'Yếu';
                        strengthBarClass += ' bg-warning';
                        break;
                    case 3:
                        strengthText = 'Trung bình';
                        strengthBarClass += ' bg-info';
                        break;
                    case 4:
                        strengthText = 'Mạnh';
                        strengthBarClass += ' bg-primary';
                        break;
                    case 5:
                        strengthText = 'Rất mạnh';
                        strengthBarClass += ' bg-success';
                        break;
                }

                if(password.length === 0){
                    width = 0;
                    strengthText = '';
                }

                $('#passwordStrengthBar').css('width', width + '%').attr('class', strengthBarClass);
                $('#passwordStrengthText').text(strengthText).attr('class', 'form-text text-' + strengthBarClass.split('bg-')[1]);
            });
        });
    </script>
}