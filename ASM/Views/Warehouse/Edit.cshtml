@model ASM.Models.Warehouse

@{
    ViewData["Title"] = "Chỉnh sửa Kho Hàng";
}

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">@ViewData["Title"]</h3>
                </div>
                <div class="card-body">
                    <form asp-action="Edit">
                        <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>
                        <input type="hidden" asp-for="Id" />

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="Code" class="form-label"></label>
                                <input asp-for="Code" class="form-control" placeholder="Ví dụ: KHO-HCM-01" />
                                <span asp-validation-for="Code" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="Name" class="form-label"></label>
                                <input asp-for="Name" class="form-control" placeholder="Ví dụ: Kho trung tâm Sài Gòn" />
                                <span asp-validation-for="Name" class="text-danger"></span>
                            </div>
                        </div>

                        <hr />
                        <h5>Thông tin địa chỉ</h5>

                        <div class="mb-3">
                            <label asp-for="Province" class="form-label"></label>
                            <select asp-for="Province" class="form-control" id="provinceSelect">
                                <option value="">-- Vui lòng chọn Tỉnh/Thành phố --</option>
                            </select>
                            <span asp-validation-for="Province" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="District" class="form-label"></label>
                            <select asp-for="District" class="form-control" id="districtSelect">
                                <option value="">-- Vui lòng chọn Quận/Huyện --</option>
                            </select>
                            <span asp-validation-for="District" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="AddressLine1" class="form-label"></label>
                            <input asp-for="AddressLine1" class="form-control" placeholder="Ví dụ: 123 Đường Lê Lợi, Phường Bến Thành" />
                            <span asp-validation-for="AddressLine1" class="text-danger"></span>
                        </div>

                        <hr />
                        <h5>Thông tin liên hệ (không bắt buộc)</h5>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="ContactPerson" class="form-label"></label>
                                <input asp-for="ContactPerson" class="form-control" placeholder="Ví dụ: Anh Nguyễn Văn A" />
                            </div>
                            <div class="col-md-6 mb-3">
                                <label asp-for="PhoneNumber" class="form-label"></label>
                                <input asp-for="PhoneNumber" class="form-control" placeholder="Ví dụ: 0909123456" />
                                <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="mt-4">
                            <button type="submit" class="btn btn-primary">Lưu thay đổi</button>
                            <a asp-action="Index" class="btn btn-secondary">Quay lại danh sách</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // --- PHẦN JAVASCRIPT ĐÃ SỬA LỖI ĐỂ HIỂN THỊ ĐÚNG DỮ LIỆU CŨ ---
        const addressData = {
            "Hà Nội": ["Ba Đình", "Hoàn Kiếm", "Hai Bà Trưng", "Đống Đa", "Tây Hồ", "Cầu Giấy", "Thanh Xuân", "Hoàng Mai", "Long Biên", "Nam Từ Liêm", "Bắc Từ Liêm", "Hà Đông"],
            "TP. Hồ Chí Minh": ["Quận 1", "Quận 3", "Quận 4", "Quận 5", "Quận 6", "Quận 7", "Quận 8", "Quận 10", "Quận 11", "Quận 12", "Bình Thạnh", "Gò Vấp", "Phú Nhuận", "Tân Bình", "Tân Phú", "Bình Tân", "Thành phố Thủ Đức"],
            "Đà Nẵng": ["Hải Châu", "Thanh Khê", "Sơn Trà", "Ngũ Hành Sơn", "Liên Chiểu", "Cẩm Lệ", "Hòa Vang"],
            "Hải Phòng": ["Hồng Bàng", "Ngô Quyền", "Lê Chân", "Hải An", "Kiến An", "Đồ Sơn", "Dương Kinh"],
            "Cần Thơ": ["Ninh Kiều", "Bình Thủy", "Cái Răng", "Ô Môn", "Thốt Nốt"],
            "Bình Dương": ["Thủ Dầu Một", "Dĩ An", "Thuận An", "Tân Uyên", "Bến Cát", "Bàu Bàng", "Phú Giáo", "Dầu Tiếng"],
            "Đồng Nai": ["Biên Hòa", "Long Khánh", "Long Thành", "Nhơn Trạch", "Trảng Bom", "Vĩnh Cửu"],
            "Bà Rịa - Vũng Tàu": ["Vũng Tàu", "Bà Rịa", "Phú Mỹ", "Châu Đức", "Xuyên Mộc"]
        };

        const provinceSelect = document.getElementById('provinceSelect');
        const districtSelect = document.getElementById('districtSelect');

        // Lấy giá trị Tỉnh và Huyện hiện tại của kho từ Model
        const currentProvince = "@Model.Province";
        const currentDistrict = "@Model.District";

        // Khi trang tải xong, thực hiện các việc sau:
        document.addEventListener('DOMContentLoaded', function() {
            // 1. Tải toàn bộ danh sách tỉnh/thành phố vào dropdown
            Object.keys(addressData).forEach(province => {
                const isSelected = province === currentProvince;
                provinceSelect.add(new Option(province, province, isSelected, isSelected));
            });

            // 2. Nếu kho này đã có tỉnh/thành phố, thì tải danh sách quận/huyện tương ứng
            if (currentProvince) {
                const districts = addressData[currentProvince] || [];
                districts.forEach(district => {
                    const isSelected = district === currentDistrict;
                    districtSelect.add(new Option(district, district, isSelected, isSelected));
                });
                // Mở khóa dropdown quận/huyện
                districtSelect.disabled = false;
            }
        });

        // Khi người dùng thay đổi lựa chọn Tỉnh/Thành phố
        provinceSelect.addEventListener('change', function() {
            districtSelect.innerHTML = '<option value="">-- Vui lòng chọn Quận/Huyện --</option>';
            const selectedProvince = this.value;
            if (selectedProvince) {
                const districts = addressData[selectedProvince] || [];
                districts.forEach(district => {
                    districtSelect.add(new Option(district, district));
                });
                districtSelect.disabled = false;
            } else {
                districtSelect.disabled = true;
            }
        });
    </script>
}